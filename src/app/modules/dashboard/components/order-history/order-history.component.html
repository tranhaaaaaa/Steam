<div class="p-6 max-w-5xl mx-auto bg-white/90 shadow-2xl rounded-3xl backdrop-blur-md" style="background: linear-gradient(to bottom, #3d224a, #1b2838 500px);">
  <h1 class="text-3xl font-extrabold text-gray-800 mb-6">Lịch Sử Đơn Hàng</h1>
  
  <!-- Kiểm tra nếu không có đơn hàng -->
  <div *ngIf="listOrder.length === 0" class="text-center text-xl text-gray-500">
    <p>Chưa có đơn hàng</p>
  </div>

  <!-- Bảng Lịch sử Đơn Hàng -->
  <table *ngIf="listOrder.length > 0" class="min-w-full bg-white border border-gray-200 rounded-lg shadow-lg transition-transform transform hover:scale-105" style="background: linear-gradient(to bottom, #3d224a, #1b2838 500px);">
    <thead class="bg-gray-100 text-gray-700 text-base" style="background: linear-gradient(to bottom, #3d224a, #1b2838 500px);">
      <tr>
        <th class="px-6 py-4" style="color:white">Mã Đơn Hàng</th>
        <th class="px-6 py-4" style="color:white">Ngày Mua</th>
        <th class="px-6 py-4" style="color:white">Số Tiền</th>
        <th class="px-6 py-4" style="color:white">Trạng Thái</th>
        <th class="px-6 py-4" style="color:white">Hành Động</th>
        <th class="px-6 py-4" style="color:white">Chức năng</th>


      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of pagedOrders" class="border-t border-gray-200 hover:bg-gray-500 transition">
        <td class="px-6 py-4">{{ order.Id }}</td>
        <td class="px-6 py-4">{{ order.OrderDate | date: 'dd/MM/yyyy HH:mm a' }}</td>
        <td class="px-6 py-4">{{ order.TotalAmount | number }} đ</td>
        <td class="px-6 py-4">
          <span [ngClass]="{
            'text-green-500': order.Status === 'Success',
             'text-violet-500': order.Status === 'COMPLETED',
            'text-yellow-500': order.Status === 'Pending',
            'text-blue-500': order.Status === 'pending',
            'text-red-500': order.Status === 'Cancelled',
            'text-pink-500': order.Status === 'await'
            
          }">
            {{ getStatusText(order.Status) }}
          </span>
        </td>
        <td class="px-6 py-4 space-x-4">
          <button (click)="viewDetails(order)" class="text-green-600 hover:underline font-medium cursor-pointer">Xem Chi Tiết</button>
          
        </td>
        <td class="px-8 py-4 space-x-4" *ngIf="order.Status === 'Success' || order.Status === 'success' || order.Status === 'COMPLETED'">
           <button (click)="onOpenReason(order.TotalAmount,order.Id)" class="text-green-600 hover:underline font-medium cursor-pointer">Yêu cầu hoàn tiền</button>
        </td>
          <td class="px-8 py-4 space-x-4" *ngIf="order.Status === 'pending' || order.Status === 'Pending'">
           <button (click)="onOpenPayment(order.TotalAmount,order.Id)" class="text-yellow-600 hover:underline font-medium cursor-pointer">Thanh toán</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Phân trang -->
  <div class="flex justify-center mt-6">
    <button class="bg-gray-500 text-white px-4 py-2 rounded-l-md hover:bg-gray-600"
            [disabled]="currentPage === 1"
            (click)="changePage(currentPage - 1)">Trước</button>

    <span class="px-4 py-2 text-white">Trang {{ currentPage }} / {{ totalPages }}</span>

    <button class="bg-gray-500 text-white px-4 py-2 rounded-r-md hover:bg-gray-600"
            [disabled]="currentPage === totalPages"
            (click)="changePage(currentPage + 1)">Sau</button>
  </div>
</div>

<!-- Modal Chi Tiết Đơn Hàng -->
<!-- Modal Chi Tiết Đơn Hàng -->
<div *ngIf="isDialogOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-8 w-full max-w-lg shadow-xl relative animate-fade-in" style="background: linear-gradient(to bottom, #3d224a, #1b2838 500px);">
    <h2 class="text-2xl font-bold text-gray-100 mb-6">Chi Tiết Đơn Hàng</h2>

    <div class="space-y-5">
      <div>
        <label class="block mb-1 font-medium text-gray-100">Mã Đơn Hàng</label>
        <input [(ngModel)]="tempOrder.Id" name="OrderId" disabled style="color:black"
               class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-100">Ngày Mua</label>
        <input [value]="tempOrder.OrderDate | date: 'dd/MM/yyyy HH:mm a'" name="OrderDate" disabled style="color:black"
               class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-100">Số Tiền</label>
        <input [value]="tempOrder.TotalAmount | number" name="TotalAmount" disabled style="color:black"
               class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" />
      </div>

     <div>
  <label class="block mb-1 font-medium text-gray-100">Trạng Thái</label>
  <input  name="Status" disabled style="color:black"
         class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" 
         [value]="getStatusText(tempOrder.Status)" />
</div>

      
      <!-- Hiển thị danh sách game đã mua -->
      <div class="mt-6">
        <h3 class="text-xl font-semibold text-gray-800">Chi Tiết Sản Phẩm:</h3>
        <div *ngIf="tempOrder.OrderDetails.length > 0">
          <ul class="list-disc pl-5 mt-3">
            <li *ngFor="let game of tempOrder.OrderDetails">
              <div class="flex justify-between">
                <span class="font-medium">{{ game.GameName }}</span>
                <span class="text-gray-600">{{ game.UnitPrice| number }} đ</span>
              </div>
            </li>
          </ul>
        </div>
        <div *ngIf="tempOrder.OrderDetails.length === 0" class="text-gray-500 mt-2">
          <p>Không có sản phẩm nào trong đơn hàng này.</p>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 pt-4">
      <button type="button" (click)="closeDialog()"
              class="px-4 py-2 border rounded-xl text-gray-100 hover:bg-gray-700">Đóng</button>
    </div>
  </div>
</div>


<div *ngIf="isPaymentDialogOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-[#1b2838] p-6 rounded-lg text-white w-96"
       [ngStyle]="{ 'width': '24rem', 'padding': '1.5rem', 'border-radius': '0.5rem', 'background-color': '#1b2838' }">
    <h3 class="text-xl font-semibold mb-4" [ngStyle]="{ 'font-size': '1.25rem', 'font-weight': '600', 'margin-bottom': '1rem' }">
      Chọn phương thức thanh toán
    </h3>
    <div class="space-y-4">
      <button
        class="w-full py-2 bg-[#3d9eff] rounded-md text-sm text-white hover:bg-[#2775e6] transition"
        [ngStyle]="{ 'background-color': '#3d9eff', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }"
        (click)="payWithVNPay()">
        <i class="fab fa-cc-visa inline-block h-6 mr-2"></i>
        Thanh toán bằng VNPay
      </button>
<button (click)="payWithWallet()"
    class="w-full py-2 bg-[#28a745] rounded-md text-sm text-white hover:bg-[#218838] transition"
    [ngStyle]="{ 'background-color': '#28a745', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }">
    <i class="fab fa-cc-visa inline-block h-6 mr-2"></i>
    Thanh toán bằng Ví GSW
</button>
    </div>
    <button
      class="mt-4 w-full py-2 bg-[#2f323b] rounded-md text-sm text-white hover:bg-[#3b3f4a] transition"
      [ngStyle]="{ 'background-color': '#2f323b', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }"
      (click)="closePaymentDialog()">
      Đóng
    </button>
  </div>
</div>


<div *ngIf="dialogReason" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-8 w-full max-w-lg shadow-xl relative animate-fade-in" style="background: linear-gradient(to bottom, #3d224a, #1b2838 500px);">
    <h2 class="text-2xl font-bold text-gray-100 mb-6">Hoàn tiền cho đơn hàng</h2>

    <div class="space-y-5">
      <div>
        <label class="block mb-1 font-medium text-gray-100">Mã Đơn Hàng</label>
        <input [(ngModel)]="this.odId" name="OrderId" disabled style="color:black"
               class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-100">Lý do hoàn tiền</label>
        <input  style="color:black"
        [(ngModel)]="reason"
               class="w-full p-3 border rounded-xl focus:outline-none focus:ring focus:ring-blue-300 bg-gray-50" />
      </div>

    <div class="flex justify-end gap-3 pt-4">
       <button type="button" (click)="onRequestRefund()"
              style="background-color: #2b61cc;"
              class="px-4 py-2 border rounded-xl text-gray-800 hover:bg-gray-700">Gửi</button>
      <button type="button" (click)="onCloseReason()"
              class="px-4 py-2 border rounded-xl text-gray-100 hover:bg-gray-700">Đóng</button>
              
    </div>
  </div>
</div>
</div>
<!-- <div *ngIf="isPaymentDialogOpen" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center z-50"
     [ngStyle]="{ 'background-color': 'rgba(0, 0, 0, 0.5)' }">
  <div class="bg-[#1b2838] p-6 rounded-lg text-white w-96"
       [ngStyle]="{ 'width': '24rem', 'padding': '1.5rem', 'border-radius': '0.5rem', 'background-color': '#1b2838' }">
    <h3 class="text-xl font-semibold mb-4" [ngStyle]="{ 'font-size': '1.25rem', 'font-weight': '600', 'margin-bottom': '1rem' }">
      Chọn phương thức thanh toán
    </h3>
    <div class="space-y-4">
      <button
        class="w-full py-2 bg-[#3d9eff] rounded-md text-sm text-white hover:bg-[#2775e6] transition"
        [ngStyle]="{ 'background-color': '#3d9eff', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }"
        (click)="payWithVNPay()">
        <i class="fab fa-cc-visa inline-block h-6 mr-2"></i>
        Thanh toán bằng VNPay
      </button>
<button (click)="payWithWallet()"
    class="w-full py-2 bg-[#28a745] rounded-md text-sm text-white hover:bg-[#218838] transition"
    [ngStyle]="{ 'background-color': '#28a745', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }">
    <i class="fab fa-cc-visa inline-block h-6 mr-2"></i>
    Thanh toán bằng Ví GSW
</button>
    </div>
    <button
      class="mt-4 w-full py-2 bg-[#2f323b] rounded-md text-sm text-white hover:bg-[#3b3f4a] transition"
      [ngStyle]="{ 'background-color': '#2f323b', 'border-radius': '0.375rem', 'padding': '0.5rem', 'text-align': 'center' }"
      (click)="closePaymentDialog()">
      Đóng
    </button>
  </div>
</div> -->

